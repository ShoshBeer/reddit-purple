async function getPostObjects(e){let t=[];const s=e.map((async e=>(void 0===e&&console.log("this is undefined for some reason"),await fetch(e)))),o=await Promise.allSettled(s);return(await Promise.all(o.filter(((s,o)=>"fulfilled"===s.status&&!0===s.value.ok&&t.push(e[o]))).map((e=>e.value.json())))).filter((e=>2===e.length)).map(((e,s)=>{const{title:o,author:r,score:a,subreddit_name_prefixed:i,selftext:n,created_utc:d,url:l,permalink:c,secure_media_embed:g}=e[0].data.children[0].data;return{title:o,author:r,score:a,subreddit_name_prefixed:i,selftext:n,comments:e[1].data.children.map((e=>[e.data.body,e.data.author,e.data.score,e.data.total_awards_received])),url:l,created_utc:d,secure_media_embed:g,jsonlink:t[s],permalink:c}}))}chrome.runtime.onMessage.addListener((async(e,t)=>{console.log("Service Worker recieved Message: ",e.type,"\nFrom Sender: ",t.id),"storeLinks"===e.type&&(console.log("Trying to store links: ",{[t.tab.id]:{url:e.url,links:e.links}}),chrome.storage.session.set({[t.tab.id]:{url:e.url,links:await getPostObjects(e.links)}})),"doneCheck"===e.type&&chrome.storage.session.get(t.tab.id.toString()).then((e=>{console.log("Result of get: ",e,"\nTrying to set: ",{...e[t.tab.id.toString()],done:!0}),chrome.storage.session.set({[t.tab.id]:{...e[t.tab.id.toString()],done:!0}})})),"startCheck"===e.type&&chrome.storage.sesssion.get(t.tab.id.toString()).then((e=>{console.log("Starting Check. \nSetting Done: false \nTrying to set: ",{...e[t.tab.id.toString()],done:!0}),chrome.storage.session.set({[t.tab.id]:{...e[t.tab.id.toString()],done:!1}})}))})),chrome.webNavigation.onCompleted.addListener((e=>{chrome.scripting.executeScript({target:{tabId:e.tabId},files:["./inject_script.js"]}).then((()=>{chrome.scripting.executeScript({target:{tabId:e.tabId},files:["./foreground.bundle.js"]})}))}),{url:[{urlMatches:"reddit.com/r/[^/]+/comments/[^/]+"}]});